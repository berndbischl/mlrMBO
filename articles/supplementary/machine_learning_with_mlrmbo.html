<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Machine learning with mlrMBO: Tuning hyperparameters with model-based optimization • mlrMBO</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Machine learning with mlrMBO: Tuning hyperparameters with model-based optimization">
<meta property="og:description" content="mlrMBO">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">mlrMBO</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.5-9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../articles/mlrMBO.html">
    <span class="fa fa-bolt"></span>
     
    Quickstart
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-file-text-o"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/supplementary/mixed_space_optimization.html">Mixed Space Optimization</a>
    </li>
    <li>
      <a href="../../articles/supplementary/parallelization.html">Parallelization</a>
    </li>
    <li>
      <a href="../../articles/supplementary/noisy_optimization.html">Noisy Optimization</a>
    </li>
    <li>
      <a href="../../articles/supplementary/infill_criteria.html">Infill Criteria</a>
    </li>
    <li>
      <a href="../../articles/supplementary/machine_learning_with_mlrmbo.html">Machine learning with mlrMBO</a>
    </li>
    <li>
      <a href="../../articles/supplementary/human_in_the_loop_MBO.html">Human-in-the-loop MBO</a>
    </li>
    <li>
      <a href="../../articles/supplementary/mlrmbo_and_the_command_line.html">mlrMBO and the Command Line</a>
    </li>
    <li>
      <a href="../../articles/supplementary/adaptive_infill_criteria.html">Adaptive Infill Criteria</a>
    </li>
    <li>
      <a href="../../articles/supplementary/warmstart.html">Warm Starting Optimization</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mlr-org/mlrMBO/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://stackoverflow.com/questions/tagged/mlr" class="external-link">
    <span class="fab fa-stack-overflow"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-org.com/" class="external-link">
    <span class="fa fa-rss"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="machine_learning_with_mlrmbo_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Machine learning with mlrMBO: Tuning hyperparameters with model-based optimization</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mlr-org/mlrMBO/blob/HEAD/vignettes/supplementary/machine_learning_with_mlrmbo.Rmd" class="external-link"><code>vignettes/supplementary/machine_learning_with_mlrmbo.Rmd</code></a></small>
      <div class="hidden name"><code>machine_learning_with_mlrmbo.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="purpose">Purpose<a class="anchor" aria-label="anchor" href="#purpose"></a>
</h2>
<p>This Vignette is supposed to give you an introduction on how to use <code>mlrMBO</code> for hyperparameter tuning in the context of machine learning using the <code>mlr</code> package.</p>
</div>
<div class="section level2">
<h2 id="mlr">
<code>mlr</code><a class="anchor" aria-label="anchor" href="#mlr"></a>
</h2>
<p>For the purpose of hyperparameter tuning, we will use the <a href="/mlr-tutorial/devel/html/index.html"><code>mlr</code></a> package. <code>mlr</code> provides a framework for machine learning in R that comes with a broad range of machine learning functionalities and is easily extendable. One possible approach is to use <code>mlr</code> to train a learner and evaluate its performance for a given hyperparameter configuration in the objective function. Alternatively, we can access <code>mlrMBO</code>’s model-based optimization directly using <a href="/mlr-tutorial/devel/html/tune/index.html"><code>mlr</code>’s tuning functionalities</a>. This yields the benefit of integrating hyperparameter tuning with model-based optimization into your machine learning experiments without any overhead.</p>
</div>
<div class="section level2">
<h2 id="preparations">Preparations<a class="anchor" aria-label="anchor" href="#preparations"></a>
</h2>
<p>First, we load the required packages. Next, we configure <code>mlr</code> to suppress the learner output to improve output readability. Additionally, we define a global variable giving the number of tuning iterations. Note that this number is set (very) low to reduce runtime.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mlr-org/mlrMBO" class="external-link">mlrMBO</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr.mlr-org.com" class="external-link">mlr</a></span><span class="op">)</span>

<span class="fu"><a href="https://mlr.mlr-org.com/reference/configureMlr.html" class="external-link">configureMlr</a></span><span class="op">(</span>on.learner.warning <span class="op">=</span> <span class="st">"quiet"</span>, show.learner.output <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">iters</span> <span class="op">=</span> <span class="fl">5</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="custom-objective-function-to-evaluate-performance">1 Custom objective function to evaluate performance<a class="anchor" aria-label="anchor" href="#custom-objective-function-to-evaluate-performance"></a>
</h2>
<p>As an example, we tune the <code>cost</code> and the <code>gamma</code> parameter of a rbf-SVM on the <a href="https://en.wikipedia.org/wiki/Iris_flower_data_set" class="external-link">Iris data</a>. First, we define the parameter set. Note that the transformations added in the <code>trafo</code> argument mean, that we tune the parameters on a logarithmic scale.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">par.set</span> <span class="op">=</span> <span class="fu"><a href="https://paramhelpers.mlr-org.com/reference/makeParamSet.html" class="external-link">makeParamSet</a></span><span class="op">(</span>
  <span class="fu"><a href="https://paramhelpers.mlr-org.com/reference/Param.html" class="external-link">makeNumericParam</a></span><span class="op">(</span><span class="st">"cost"</span>, <span class="op">-</span><span class="fl">15</span>, <span class="fl">15</span>, trafo <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">2</span><span class="op">^</span><span class="va">x</span><span class="op">)</span>,
  <span class="fu"><a href="https://paramhelpers.mlr-org.com/reference/Param.html" class="external-link">makeNumericParam</a></span><span class="op">(</span><span class="st">"gamma"</span>, <span class="op">-</span><span class="fl">15</span>, <span class="fl">15</span>, trafo <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">2</span><span class="op">^</span><span class="va">x</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Next, we define the objective function. First, we define a learner and set its hyperparameters by using <code>makeLearner</code>. To evaluate its performance we use the <code>resample</code> function which automatically takes care of fitting the model and evaluating it on a test set. In this example, resampling is done using 3-fold cross-validation, by passing the <code>ResampleDesc</code> object <code>cv3</code>, that comes predefined with <code>mlr</code>, as an argument to <code>resample</code>. The measure to be optimized can be specified (e.g by passing <code>measures = ber</code>, for the <em>balanced error rate</em>), however <code>mlr</code> has a default for each task type. For classification the <code>mmce</code>(Mean misclassification rate) is the default. Like <a href="mixed_space_optimization.html" title="Mixed Space Optimization">in this example</a>, we set <code>minimize = TRUE</code> and <code>has.simple.signature = FALSE</code>. Note that the <code>iris.task</code> is provided automatically when loading <code>mlr</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">svm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/smoof/man/makeSingleObjectiveFunction.html" class="external-link">makeSingleObjectiveFunction</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"svm.tuning"</span>,
  fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">lrn</span> <span class="op">=</span> <span class="fu"><a href="https://mlr.mlr-org.com/reference/makeLearner.html" class="external-link">makeLearner</a></span><span class="op">(</span><span class="st">"classif.svm"</span>, par.vals <span class="op">=</span> <span class="va">x</span><span class="op">)</span>
    <span class="fu"><a href="https://mlr.mlr-org.com/reference/resample.html" class="external-link">resample</a></span><span class="op">(</span><span class="va">lrn</span>, <span class="va">iris.task</span>, <span class="va">cv3</span>, show.info <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">aggr</span>
  <span class="op">}</span>,
  par.set <span class="op">=</span> <span class="va">par.set</span>,
  noisy <span class="op">=</span> <span class="cn">TRUE</span>,
  has.simple.signature <span class="op">=</span> <span class="cn">FALSE</span>,
  minimize <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<p>Now we create a default <code>MBOControl</code> object and tune the rbf-SVM.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ctrl</span> <span class="op">=</span> <span class="fu"><a href="../../reference/makeMBOControl.html">makeMBOControl</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">ctrl</span> <span class="op">=</span> <span class="fu"><a href="../../reference/setMBOControlTermination.html">setMBOControlTermination</a></span><span class="op">(</span><span class="va">ctrl</span>, iters <span class="op">=</span> <span class="va">iters</span><span class="op">)</span>

<span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="../../reference/mbo.html">mbo</a></span><span class="op">(</span><span class="va">svm</span>, control <span class="op">=</span> <span class="va">ctrl</span>, show.info <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
<span class="co">## Recommended parameters:</span>
<span class="co">## cost=10.6; gamma=-12.1</span>
<span class="co">## Objective: y = 0.027</span>
<span class="co">## </span>
<span class="co">## Optimization path</span>
<span class="co">## 8 + 5 entries in total, displaying last 10 (or less):</span>
<span class="co">##          cost      gamma          y dob eol error.message exec.time          cb</span>
<span class="co">## 4  -14.644348  -2.100631 0.73333333   0  NA          &lt;NA&gt;     0.158          NA</span>
<span class="co">## 5    1.439886  -4.670718 0.04666667   0  NA          &lt;NA&gt;     0.151          NA</span>
<span class="co">## 6   12.278939   6.109579 0.53333333   0  NA          &lt;NA&gt;     0.141          NA</span>
<span class="co">## 7   10.554900 -12.336816 0.03333333   0  NA          &lt;NA&gt;     0.132          NA</span>
<span class="co">## 8   -5.818064   7.502343 0.70666667   0  NA          &lt;NA&gt;     0.137          NA</span>
<span class="co">## 9   10.555933 -12.055114 0.02666667   1  NA          &lt;NA&gt;     0.200  0.02015471</span>
<span class="co">## 10   5.433675  -8.946188 0.04000000   2  NA          &lt;NA&gt;     0.139 -0.17442706</span>
<span class="co">## 11   9.331960  -5.809406 0.06666667   3  NA          &lt;NA&gt;     0.135 -0.09793003</span>
<span class="co">## 12  13.587864  -9.940151 0.04666667   4  NA          &lt;NA&gt;     0.153 -0.04694097</span>
<span class="co">## 13   2.421178 -10.266161 0.19333333   5  NA          &lt;NA&gt;     0.134 -0.02600454</span>
<span class="co">##    error.model train.time  prop.type propose.time         se        mean lambda</span>
<span class="co">## 4         &lt;NA&gt;         NA initdesign           NA         NA          NA     NA</span>
<span class="co">## 5         &lt;NA&gt;         NA initdesign           NA         NA          NA     NA</span>
<span class="co">## 6         &lt;NA&gt;         NA initdesign           NA         NA          NA     NA</span>
<span class="co">## 7         &lt;NA&gt;         NA initdesign           NA         NA          NA     NA</span>
<span class="co">## 8         &lt;NA&gt;         NA initdesign           NA         NA          NA     NA</span>
<span class="co">## 9         &lt;NA&gt;      0.058  infill_cb        0.334 0.23258301  0.25273772      1</span>
<span class="co">## 10        &lt;NA&gt;      0.082  infill_cb        0.349 0.11501017 -0.05941690      1</span>
<span class="co">## 11        &lt;NA&gt;      0.100  infill_cb        0.307 0.11095124  0.01302121      1</span>
<span class="co">## 12        &lt;NA&gt;      0.088  infill_cb        0.316 0.11216645  0.06522548      1</span>
<span class="co">## 13        &lt;NA&gt;      0.107  infill_cb        0.350 0.07340803  0.04740349      1</span>
<span class="va">res</span><span class="op">$</span><span class="va">x</span>
<span class="co">## $cost</span>
<span class="co">## [1] 10.55593</span>
<span class="co">## </span>
<span class="co">## $gamma</span>
<span class="co">## [1] -12.05511</span>
<span class="va">res</span><span class="op">$</span><span class="va">y</span>
<span class="co">## [1] 0.02666667</span>
<span class="va">op</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">opt.path</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cummin</a></span><span class="op">(</span><span class="va">op</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, ylab <span class="op">=</span> <span class="st">"mmce"</span>, xlab <span class="op">=</span> <span class="st">"iteration"</span><span class="op">)</span></code></pre></div>
<p><img src="machine_learning_with_mlrmbo_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="using-mlrs-tuning-interface">2 Using <code>mlr</code>’s tuning interface<a class="anchor" aria-label="anchor" href="#using-mlrs-tuning-interface"></a>
</h2>
<p>Instead of defining an objective function where the learner’s performance is evaluated, we can make use of model-based optimization directly from <code>mlr</code>. We just create a <code>TuneControl</code> object, passing the <code>MBOControl</code> object to it. Then we call <a href="/mlr-tutorial/devel/html/tune/index.html"><code>tuneParams</code></a> to tune the hyperparameters.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ctrl</span> <span class="op">=</span> <span class="fu"><a href="../../reference/makeMBOControl.html">makeMBOControl</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">ctrl</span> <span class="op">=</span> <span class="fu"><a href="../../reference/setMBOControlTermination.html">setMBOControlTermination</a></span><span class="op">(</span><span class="va">ctrl</span>, iters <span class="op">=</span> <span class="va">iters</span><span class="op">)</span>
<span class="va">tune.ctrl</span> <span class="op">=</span> <span class="fu"><a href="https://mlr.mlr-org.com/reference/makeTuneControlMBO.html" class="external-link">makeTuneControlMBO</a></span><span class="op">(</span>mbo.control <span class="op">=</span> <span class="va">ctrl</span><span class="op">)</span>
<span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="https://mlr.mlr-org.com/reference/tuneParams.html" class="external-link">tuneParams</a></span><span class="op">(</span><span class="fu"><a href="https://mlr.mlr-org.com/reference/makeLearner.html" class="external-link">makeLearner</a></span><span class="op">(</span><span class="st">"classif.svm"</span><span class="op">)</span>, <span class="va">iris.task</span>, <span class="va">cv3</span>, par.set <span class="op">=</span> <span class="va">par.set</span>, control <span class="op">=</span> <span class="va">tune.ctrl</span>,
  show.info <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
<span class="co">## Tune result:</span>
<span class="co">## Op. pars: cost=13.4; gamma=0.0829</span>
<span class="co">## mmce.test.mean=0.0200000</span>
<span class="va">res</span><span class="op">$</span><span class="va">x</span>
<span class="co">## $cost</span>
<span class="co">## [1] 13.40125</span>
<span class="co">## </span>
<span class="co">## $gamma</span>
<span class="co">## [1] 0.08289002</span>
<span class="va">res</span><span class="op">$</span><span class="va">y</span>
<span class="co">## mmce.test.mean </span>
<span class="co">##           0.02</span>
<span class="va">op.y</span> <span class="op">=</span> <span class="fu"><a href="https://paramhelpers.mlr-org.com/reference/getOptPathY.html" class="external-link">getOptPathY</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">opt.path</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cummin</a></span><span class="op">(</span><span class="va">op.y</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, ylab <span class="op">=</span> <span class="st">"mmce"</span>, xlab <span class="op">=</span> <span class="st">"iteration"</span><span class="op">)</span></code></pre></div>
<p><img src="machine_learning_with_mlrmbo_files/figure-html/mlr_tuning-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="hierarchical-mixed-space-optimization">Hierarchical mixed space optimization<a class="anchor" aria-label="anchor" href="#hierarchical-mixed-space-optimization"></a>
</h2>
<p>In many cases, the hyperparameter space is not just numerical but mixed and often even hierarchical. This can easily be done out-of-the-box and needs no adaption to our previous example. (Recall that a suitable surrogate model is chosen automatically, as explained <a href="../mlrMBO.html#surrogate-model">here</a>.) To demonstrate this, we tune the <code>cost</code> and the <code>kernel</code> parameter of a SVM. When <code>kernel</code> takes the <code>radial</code> value, <code>gamma</code> needs to be specified. For a <code>polynomial</code> kernel, the <code>degree</code> needs to be specified.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">par.set</span> <span class="op">=</span> <span class="fu"><a href="https://paramhelpers.mlr-org.com/reference/makeParamSet.html" class="external-link">makeParamSet</a></span><span class="op">(</span>
  <span class="fu"><a href="https://paramhelpers.mlr-org.com/reference/Param.html" class="external-link">makeDiscreteParam</a></span><span class="op">(</span><span class="st">"kernel"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"radial"</span>, <span class="st">"polynomial"</span>, <span class="st">"linear"</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://paramhelpers.mlr-org.com/reference/Param.html" class="external-link">makeNumericParam</a></span><span class="op">(</span><span class="st">"cost"</span>, <span class="op">-</span><span class="fl">15</span>, <span class="fl">15</span>, trafo <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">2</span><span class="op">^</span><span class="va">x</span><span class="op">)</span>,
  <span class="fu"><a href="https://paramhelpers.mlr-org.com/reference/Param.html" class="external-link">makeNumericParam</a></span><span class="op">(</span><span class="st">"gamma"</span>, <span class="op">-</span><span class="fl">15</span>, <span class="fl">15</span>, trafo <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">2</span><span class="op">^</span><span class="va">x</span>, requires <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">kernel</span> <span class="op">==</span> <span class="st">"radial"</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://paramhelpers.mlr-org.com/reference/Param.html" class="external-link">makeIntegerParam</a></span><span class="op">(</span><span class="st">"degree"</span>, lower <span class="op">=</span> <span class="fl">1</span>, upper <span class="op">=</span> <span class="fl">4</span>, requires <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">kernel</span> <span class="op">==</span> <span class="st">"polynomial"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Now we can just repeat the setup from the previous example and tune the hyperparameters.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ctrl</span> <span class="op">=</span> <span class="fu"><a href="../../reference/makeMBOControl.html">makeMBOControl</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">ctrl</span> <span class="op">=</span> <span class="fu"><a href="../../reference/setMBOControlTermination.html">setMBOControlTermination</a></span><span class="op">(</span><span class="va">ctrl</span>, iters <span class="op">=</span> <span class="va">iters</span><span class="op">)</span>
<span class="va">tune.ctrl</span> <span class="op">=</span> <span class="fu"><a href="https://mlr.mlr-org.com/reference/makeTuneControlMBO.html" class="external-link">makeTuneControlMBO</a></span><span class="op">(</span>mbo.control <span class="op">=</span> <span class="va">ctrl</span><span class="op">)</span>
<span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="https://mlr.mlr-org.com/reference/tuneParams.html" class="external-link">tuneParams</a></span><span class="op">(</span><span class="fu"><a href="https://mlr.mlr-org.com/reference/makeLearner.html" class="external-link">makeLearner</a></span><span class="op">(</span><span class="st">"classif.svm"</span><span class="op">)</span>, <span class="va">iris.task</span>, <span class="va">cv3</span>, par.set <span class="op">=</span> <span class="va">par.set</span>, control <span class="op">=</span> <span class="va">tune.ctrl</span>,
  show.info <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="parallelization-and-multi-point-proposals">Parallelization and multi-point proposals<a class="anchor" aria-label="anchor" href="#parallelization-and-multi-point-proposals"></a>
</h2>
<p>We can easily add multi-point proposals and parallelize it using the <code>parallelMap</code> package. (Note that the chosen <em>multicore</em> back-end for parallelization does not work on windows machines. Please refer to the <a href="parallelization.html">parallelization section</a> for details on parallelization and multi point proposals.) In each iteration, we propose as many points as CPUs used for parallelization. As infill criterion we use Expected Improvement.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://parallelmap.mlr-org.com" class="external-link">parallelMap</a></span><span class="op">)</span>
<span class="va">ncpus</span> <span class="op">=</span> <span class="fl">2L</span>

<span class="va">ctrl</span> <span class="op">=</span> <span class="fu"><a href="../../reference/makeMBOControl.html">makeMBOControl</a></span><span class="op">(</span>propose.points <span class="op">=</span> <span class="va">ncpus</span><span class="op">)</span>
<span class="va">ctrl</span> <span class="op">=</span> <span class="fu"><a href="../../reference/setMBOControlTermination.html">setMBOControlTermination</a></span><span class="op">(</span><span class="va">ctrl</span>, iters <span class="op">=</span> <span class="va">iters</span><span class="op">)</span>
<span class="va">ctrl</span> <span class="op">=</span> <span class="fu"><a href="../../reference/setMBOControlInfill.html">setMBOControlInfill</a></span><span class="op">(</span><span class="va">ctrl</span>, crit <span class="op">=</span> <span class="va">crit.ei</span><span class="op">)</span>
<span class="va">ctrl</span> <span class="op">=</span> <span class="fu"><a href="../../reference/setMBOControlMultiPoint.html">setMBOControlMultiPoint</a></span><span class="op">(</span><span class="va">ctrl</span>, method <span class="op">=</span> <span class="st">"cl"</span>, cl.lie <span class="op">=</span> <span class="va">min</span><span class="op">)</span>
<span class="va">tune.ctrl</span> <span class="op">=</span> <span class="fu"><a href="https://mlr.mlr-org.com/reference/makeTuneControlMBO.html" class="external-link">makeTuneControlMBO</a></span><span class="op">(</span>mbo.control <span class="op">=</span> <span class="va">ctrl</span><span class="op">)</span>
<span class="fu"><a href="https://parallelmap.mlr-org.com/reference/parallelStart.html" class="external-link">parallelStartMulticore</a></span><span class="op">(</span>cpus <span class="op">=</span> <span class="va">ncpus</span><span class="op">)</span>
<span class="co">## Starting parallelization in mode=multicore with cpus=2.</span>
<span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="https://mlr.mlr-org.com/reference/tuneParams.html" class="external-link">tuneParams</a></span><span class="op">(</span><span class="fu"><a href="https://mlr.mlr-org.com/reference/makeLearner.html" class="external-link">makeLearner</a></span><span class="op">(</span><span class="st">"classif.svm"</span><span class="op">)</span>, <span class="va">iris.task</span>, <span class="va">cv3</span>, par.set <span class="op">=</span> <span class="va">par.set</span>, control <span class="op">=</span> <span class="va">tune.ctrl</span>, show.info <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">## Mapping in parallel: mode = multicore; level = mlrMBO.feval; cpus = 2; elements = 16.</span>
<span class="co">## Mapping in parallel: mode = multicore; level = mlrMBO.feval; cpus = 2; elements = 2.</span>
<span class="co">## Mapping in parallel: mode = multicore; level = mlrMBO.feval; cpus = 2; elements = 2.</span>
<span class="co">## Mapping in parallel: mode = multicore; level = mlrMBO.feval; cpus = 2; elements = 2.</span>
<span class="co">## Mapping in parallel: mode = multicore; level = mlrMBO.feval; cpus = 2; elements = 2.</span>
<span class="co">## Mapping in parallel: mode = multicore; level = mlrMBO.feval; cpus = 2; elements = 2.</span>
<span class="fu"><a href="https://parallelmap.mlr-org.com/reference/parallelStop.html" class="external-link">parallelStop</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">## Stopped parallelization. All cleaned up.</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usecase-pipeline-configuration">Usecase: Pipeline configuration<a class="anchor" aria-label="anchor" href="#usecase-pipeline-configuration"></a>
</h2>
<p>It is also possible to tune a whole machine learning pipeline, i.e. preprocessing and model configuration. The example pipeline is: * Feature filtering based on an ANOVA test or covariance, such that between 50% and 100% of the features remain. * Select either a SVM or a naive Bayes classifier. * Tune parameters of the selected classifier.</p>
<p>First, we define the parameter space:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">par.set</span> <span class="op">=</span> <span class="fu"><a href="https://paramhelpers.mlr-org.com/reference/makeParamSet.html" class="external-link">makeParamSet</a></span><span class="op">(</span>
  <span class="fu"><a href="https://paramhelpers.mlr-org.com/reference/Param.html" class="external-link">makeDiscreteParam</a></span><span class="op">(</span><span class="st">"fw.method"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"anova.test"</span>, <span class="st">"variance"</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://paramhelpers.mlr-org.com/reference/Param.html" class="external-link">makeNumericParam</a></span><span class="op">(</span><span class="st">"fw.perc"</span>, lower <span class="op">=</span> <span class="fl">0.1</span>, upper <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
  <span class="fu"><a href="https://paramhelpers.mlr-org.com/reference/Param.html" class="external-link">makeDiscreteParam</a></span><span class="op">(</span><span class="st">"selected.learner"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"classif.svm"</span>, <span class="st">"classif.naiveBayes"</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://paramhelpers.mlr-org.com/reference/Param.html" class="external-link">makeNumericParam</a></span><span class="op">(</span><span class="st">"classif.svm.cost"</span>, <span class="op">-</span><span class="fl">15</span>, <span class="fl">15</span>, trafo <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">2</span><span class="op">^</span><span class="va">x</span>,
    require <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">selected.learner</span> <span class="op">==</span> <span class="st">"classif.svm"</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://paramhelpers.mlr-org.com/reference/Param.html" class="external-link">makeNumericParam</a></span><span class="op">(</span><span class="st">"classif.svm.gamma"</span>, <span class="op">-</span><span class="fl">15</span>, <span class="fl">15</span>, trafo <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">2</span><span class="op">^</span><span class="va">x</span>,
    requires <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">classif.svm.kernel</span> <span class="op">==</span> <span class="st">"radial"</span> <span class="op">&amp;</span> <span class="va">selected.learner</span> <span class="op">==</span> <span class="st">"classif.svm"</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://paramhelpers.mlr-org.com/reference/Param.html" class="external-link">makeIntegerParam</a></span><span class="op">(</span><span class="st">"classif.svm.degree"</span>, lower <span class="op">=</span> <span class="fl">1</span>, upper <span class="op">=</span> <span class="fl">4</span>,
    requires <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">classif.svm.kernel</span> <span class="op">==</span> <span class="st">"polynomial"</span> <span class="op">&amp;</span> <span class="va">selected.learner</span> <span class="op">==</span> <span class="st">"classif.svm"</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://paramhelpers.mlr-org.com/reference/Param.html" class="external-link">makeDiscreteParam</a></span><span class="op">(</span><span class="st">"classif.svm.kernel"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"radial"</span>, <span class="st">"polynomial"</span>, <span class="st">"linear"</span><span class="op">)</span>,
    require <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">selected.learner</span> <span class="op">==</span> <span class="st">"classif.svm"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Next, we create the control objects and a suitable learner, combining <code><a href="https://mlr.mlr-org.com/reference/makeFilterWrapper.html" class="external-link">makeFilterWrapper()</a></code> with <code><a href="https://mlr.mlr-org.com/reference/makeModelMultiplexer.html" class="external-link">makeModelMultiplexer()</a></code>. (Please refer to the <a href="/mlr-tutorial/devel/html/advanced_tune/index.html#tuning-across-whole-model-spaces-with-modelmultiplexer">advanced tuning chapter of the mlr tutorial</a> for details.) Afterwards, we can run <code><a href="https://mlr.mlr-org.com/reference/tuneParams.html" class="external-link">tuneParams()</a></code> and check the results.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ctrl</span> <span class="op">=</span> <span class="fu"><a href="../../reference/makeMBOControl.html">makeMBOControl</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">ctrl</span> <span class="op">=</span> <span class="fu"><a href="../../reference/setMBOControlTermination.html">setMBOControlTermination</a></span><span class="op">(</span><span class="va">ctrl</span>, iters <span class="op">=</span> <span class="va">iters</span><span class="op">)</span>
<span class="va">lrn</span> <span class="op">=</span> <span class="fu"><a href="https://mlr.mlr-org.com/reference/makeFilterWrapper.html" class="external-link">makeFilterWrapper</a></span><span class="op">(</span><span class="fu"><a href="https://mlr.mlr-org.com/reference/makeModelMultiplexer.html" class="external-link">makeModelMultiplexer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"classif.svm"</span>, <span class="st">"classif.naiveBayes"</span><span class="op">)</span><span class="op">)</span>, fw.method <span class="op">=</span> <span class="st">"variance"</span><span class="op">)</span>
<span class="va">tune.ctrl</span> <span class="op">=</span> <span class="fu"><a href="https://mlr.mlr-org.com/reference/makeTuneControlMBO.html" class="external-link">makeTuneControlMBO</a></span><span class="op">(</span>mbo.control <span class="op">=</span> <span class="va">ctrl</span><span class="op">)</span>

<span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="https://mlr.mlr-org.com/reference/tuneParams.html" class="external-link">tuneParams</a></span><span class="op">(</span><span class="va">lrn</span>, <span class="va">iris.task</span>, <span class="va">cv3</span>, par.set <span class="op">=</span> <span class="va">par.set</span>, control <span class="op">=</span> <span class="va">tune.ctrl</span>, show.info <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
<span class="co">## Tune result:</span>
<span class="co">## Op. pars: fw.method=anova.test; fw.perc=0.905; selected.learner=classif.svm; classif.svm.cost=0.501; classif.svm.kernel=linear</span>
<span class="co">## mmce.test.mean=0.0266667</span>
<span class="va">res</span><span class="op">$</span><span class="va">x</span>
<span class="co">## $fw.method</span>
<span class="co">## [1] "anova.test"</span>
<span class="co">## </span>
<span class="co">## $fw.perc</span>
<span class="co">## [1] 0.9050354</span>
<span class="co">## </span>
<span class="co">## $selected.learner</span>
<span class="co">## [1] "classif.svm"</span>
<span class="co">## </span>
<span class="co">## $classif.svm.cost</span>
<span class="co">## [1] 0.5007066</span>
<span class="co">## </span>
<span class="co">## $classif.svm.kernel</span>
<span class="co">## [1] "linear"</span>
<span class="va">res</span><span class="op">$</span><span class="va">y</span>
<span class="co">## mmce.test.mean </span>
<span class="co">##     0.02666667</span>
<span class="va">op</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">opt.path</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cummin</a></span><span class="op">(</span><span class="va">op</span><span class="op">$</span><span class="va">mmce.test.mean</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, ylab <span class="op">=</span> <span class="st">"mmce"</span>, xlab <span class="op">=</span> <span class="st">"iteration"</span><span class="op">)</span></code></pre></div>
<p><img src="machine_learning_with_mlrmbo_files/figure-html/pipeline_tuning-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Bernd Bischl, Jakob Richter, Jakob Bossek, Daniel Horn, Michel Lang, Janek Thomas.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
