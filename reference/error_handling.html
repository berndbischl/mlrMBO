<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Error handling for mlrMBO — error_handling • mlrMBO</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<link href="../extra.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Error handling for mlrMBO — error_handling" />
<meta property="og:description" content="There are multiple types of errors that can occur during one optimization
process. mlrMBO tries to handle most of them as smart as possible.
The target function could
1The target function returns NA(s) or NaN(s) (plural for the multi-objective case).
2The target function stops with an error.
3The target function does not return at all (infinite or very long execution time).
4The target function crashes the whole R process.
5The surrogate machine learning model might crash.
    Kriging quite often can run into numerical problems.
6The proposal mechanism - in multi-point or single point mode - produces
    a point which is either close to another candidate point in the same iteration or
    an already visited point in a previous iteration.
7The mbo process exits / stops / crashes itself. Maybe because it hit a walltime.



Mechanism I - Objective value imputation
Issues 1-4 all have in common that the optimizer does not obtain a useful
objective value. 3-4 are problematic, because we completely lose control of the R process.
We are currently only able to handle them, if you are parallelizing your optimization
via parallelMap and use the BatchJobs mode.
In this case, you can specify a walltime (handles 3) and the function evaluation is performed
in a separate R process (handles 4). A later path might be to allow function evaluation in
a separate process in general, with a capping time. If you really need this now, you can always
do this yourself.
Now back to the problem of invalid objective values. By default, the mbo function stops with an error
(if it still has control of the process). But in many cases you still want the algorithm to continue.
Hence, mbo allows imputation of bad values via the control option impute.y.fun.
Logging: All error messages are logged into the optimization path opt.path if problems occur.

Mechanism II - The mlr's on.learner.error
If your surrogate learner crashes you can set on.surrogate.error in makeMBOControl to &amp;#8220;quiet&amp;#8221; or &amp;#8220;warn&amp;#8221;.
This will set mlr's on.learner.error for the surrogate.
It prevents MBO from crashing in total (issue 5), if the surrogate learner produces an error.
As a resort a FailureModel will be returned instead of a the surrogate.
Subsequently a random point (or multiple ones) are proposed now for the current iteration.
And we pray that we can fit the model again in the next iteration.
Logging: The entry &amp;#8220;model.error&amp;#8221; is set in the opt.path.

Mechanism III - Filtering of proposed point which are too close
Issue 6 is solved by filtering points that are to close to other proposed points or points already
proposed in preceding iterations. Filtering in this context means replacing the proposed points by
a randomly generated new point. The heuristics mechanism is (de)activated via the logical
filter.proposed.points.tol parameter of the setMBOControlInfill function, which defaults to
TRUE.(closeness of two points is determined via the filter.proposed.points.tol parameter).
Logging: The logical entry &amp;#8220;filtered.point&amp;#8221; is set in the opt.path indicating whether the
corresponding point was filtered.

Mechanism IV - Continue optimization process
The mechanism is a save-state-then-continue-mechanism, that allows you to continue
your optimization after your system or the optimization process crashed for
some reason (issue 7). The mbo function has the option to save the
current state after certain iterations of the main loop on disk via the control
option save.on.disk.at of makeMBOControl.
Note that this saving mechanism is disabled by default.
Here you can specify, after which iteration you want the current state to be
saved (option save.on.disk.at). Notice that 0 denotes saving the initial
design and iters + 1 denotes saving the final results.
With mboContinue you can continue the optimization from the last
saved state. This function only requires the path of the saved state.
You will get a warning if you turn on saving in general, but not for the the final result, as
this seems a bit stupid. save.file.path defines the path of the RData file where
the state is stored. It is overwritten (= extended) in each saving iteration." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a href="https://mlr-org.com"><img src="https://raw.githubusercontent.com/mlr-org/mlr3/master/man/figures/logo.png" id="hexlogo" alt="mlr-org" /></a>
        <a class="navbar-brand" href="../index.html">mlrMBO <small>v1.1.4-9000</small></a>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../articles/mlrMBO.html">
    <span class="fa fa-bolt"></span>
     
    Quickstart
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-file-text-o"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/supplementary/mixed_space_optimization.html">Mixed Space Optimization</a>
    </li>
    <li>
      <a href="../articles/supplementary/parallelization.html">Parallelization</a>
    </li>
    <li>
      <a href="../articles/supplementary/noisy_optimization.html">Noisy Optimization</a>
    </li>
    <li>
      <a href="../articles/supplementary/infill_criteria.html">Infill Criteria</a>
    </li>
    <li>
      <a href="../articles/supplementary/machine_learning_with_mlrmbo.html">Machine learning with mlrMBO</a>
    </li>
    <li>
      <a href="../articles/supplementary/human_in_the_loop_MBO.html">Human-in-the-loop MBO</a>
    </li>
    <li>
      <a href="../articles/supplementary/mlrmbo_and_the_command_line.html">mlrMBO and the Command Line</a>
    </li>
    <li>
      <a href="../articles/supplementary/adaptive_infill_criteria.html">Adaptive Infill Criteria</a>
    </li>
    <li>
      <a href="../articles/supplementary/warmstart.html">Warm Starting Optimization</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://lmmisld-lmu-stats-slds.srv.mwn.de/mlr_invite/">
    <span class="fa fa fa fa-comments"></span>
     
  </a>
</li>
        <li>
  <a href="https://github.com/mlr-org/mlrMBO/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://stackoverflow.com/questions/tagged/mlr">
    <span class="fab fa fab fa-stack-overflow"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-org.com/">
    <span class="fa fa-rss"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Error handling for mlrMBO</h1>
    <small class="dont-index">Source: <a href='https://github.com/mlr-org/mlrMBO/blob/master/R/doc_error_handling.R'><code>R/doc_error_handling.R</code></a></small>
    <div class="hidden name"><code>error_handling.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>There are multiple types of errors that can occur during one optimization
process. mlrMBO tries to handle most of them as smart as possible.</p>
<p>The target function could</p><ul>
<li><p>1The target function returns NA(s) or NaN(s) (plural for the multi-objective case).</p></li>
<li><p>2The target function stops with an error.</p></li>
<li><p>3The target function does not return at all (infinite or very long execution time).</p></li>
<li><p>4The target function crashes the whole R process.</p></li>
<li><p>5The surrogate machine learning model might crash.
    Kriging quite often can run into numerical problems.</p></li>
<li><p>6The proposal mechanism - in multi-point or single point mode - produces
    a point which is either close to another candidate point in the same iteration or
    an already visited point in a previous iteration.</p></li>
<li><p>7The mbo process exits / stops / crashes itself. Maybe because it hit a walltime.</p></li>
</ul>


<p><strong>Mechanism I - Objective value imputation</strong>
Issues 1-4 all have in common that the optimizer does not obtain a useful
objective value. 3-4 are problematic, because we completely lose control of the R process.
We are currently only able to handle them, if you are parallelizing your optimization
via <code><a href='https://parallelmap.mlr-org.com/reference/parallelMap.html'>parallelMap</a></code> and use the BatchJobs mode.
In this case, you can specify a walltime (handles 3) and the function evaluation is performed
in a separate R process (handles 4). A later path might be to allow function evaluation in
a separate process in general, with a capping time. If you really need this now, you can always
do this yourself.</p>
<p>Now back to the problem of invalid objective values. By default, the mbo function stops with an error
(if it still has control of the process). But in many cases you still want the algorithm to continue.
Hence, mbo allows imputation of bad values via the control option <code>impute.y.fun</code>.</p>
<p><strong>Logging:</strong> All error messages are logged into the optimization path <code>opt.path</code> if problems occur.</p>

<p><strong>Mechanism II - The mlr's on.learner.error</strong>
If your surrogate learner crashes you can set <code>on.surrogate.error</code> in <code><a href='makeMBOControl.html'>makeMBOControl</a></code> to &#8220;quiet&#8221; or &#8220;warn&#8221;.
This will set mlr's <code>on.learner.error</code> for the surrogate.
It prevents MBO from crashing in total (issue 5), if the surrogate learner produces an error.
As a resort a FailureModel will be returned instead of a the surrogate.
Subsequently a random point (or multiple ones) are proposed now for the current iteration.
And we pray that we can fit the model again in the next iteration.
<strong>Logging:</strong> The entry &#8220;model.error&#8221; is set in the <code>opt.path</code>.</p>

<p><strong>Mechanism III - Filtering of proposed point which are too close</strong></p>
<p>Issue 6 is solved by filtering points that are to close to other proposed points or points already
proposed in preceding iterations. Filtering in this context means replacing the proposed points by
a randomly generated new point. The heuristics mechanism is (de)activated via the logical
<code>filter.proposed.points.tol</code> parameter of the <code><a href='setMBOControlInfill.html'>setMBOControlInfill</a></code> function, which defaults to
<code>TRUE</code>.(closeness of two points is determined via the <code>filter.proposed.points.tol</code> parameter).</p>
<p><strong>Logging:</strong> The logical entry &#8220;filtered.point&#8221; is set in the opt.path indicating whether the
corresponding point was filtered.</p>

<p><strong>Mechanism IV - Continue optimization process</strong></p>
<p>The mechanism is a save-state-then-continue-mechanism, that allows you to continue
your optimization after your system or the optimization process crashed for
some reason (issue 7). The <code><a href='mbo.html'>mbo</a></code> function has the option to save the
current state after certain iterations of the main loop on disk via the control
option <code>save.on.disk.at</code> of <code><a href='makeMBOControl.html'>makeMBOControl</a></code>.
Note that this saving mechanism is <em>disabled</em> by default.
Here you can specify, after which iteration you want the current state to be
saved (option <code>save.on.disk.at</code>). Notice that 0 denotes saving the initial
design and <code>iters</code> + 1 denotes saving the final results.
With <code><a href='mboContinue.html'>mboContinue</a></code> you can continue the optimization from the last
saved state. This function only requires the path of the saved state.</p>
<p>You will get a warning if you turn on saving in general, but not for the the final result, as
this seems a bit stupid. <code>save.file.path</code> defines the path of the RData file where
the state is stored. It is overwritten (= extended) in each saving iteration.</p>
    </div>




  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Bernd Bischl, Jakob Richter, Jakob Bossek, Daniel Horn, Michel Lang, Janek Thomas.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


